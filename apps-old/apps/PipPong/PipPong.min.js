function PipPong(){function z(){t(a.x,a.y,m,m,H)}function A(e,f,h){g.setColor(i);const d=2*h;const c=4*h;const j=3*h;const k=1*h;const a=c*.707;const b=(a,b)=>g.fillRect(e+a-d/2,f+b-d/2,e+a+d/2,f+b+d/2);b(-c,0),b(c,0),b(0,-c),b(0,c),b(-a,-a),b(a,-a),b(-a,a),b(a,a),g.fillCircle(e,f,j),g.setColor(r),g.fillCircle(e,f,k)}function p(a,b){t(a.x,a.y,q,f,b)}function t(c,d,e,f,h){g.setColor(h);const a=c*j;const b=d*j;g.fillRect(a,b,a+e*j-1,b+f*j-1)}function I(){g.clear(),p(e,i),p(b,i),z(),B()}function B(){const a=120;const b=(d-a)/2;const e=c-26;g.clearRect(b,e,b+a,c),g.setColor(v),g.setFont('6x8',2),g.drawString('Score: '+s,d/2,c-20)}function J(){clearInterval(o),g.clear(),g.setColor(v),g.setFont('6x8',4),g.drawString('GAME OVER',d/2,c/2-30),g.setFont('6x8',2),g.drawString('Score: '+s,d/2,c/2),g.setColor(i),g.drawString('Press  to restart',d/2,c/2+30),A(d/2-31,c/2+30,1.5),w=setInterval(()=>{BTN_PLAY.read()&&(clearInterval(w),x())},100)}function K(){if(k)return;L(),M(),N()}function L(){BTN_TUNEUP.read()?l(-1):BTN_TUNEDOWN.read()?l(1):BTN_TORCH.read()&&C()}function M(){p(b,r),a.y>b.y+1?b.y=Math.min(h-f,b.y+1):a.y<b.y&&(b.y=Math.max(0,b.y-1)),p(b,i)}function N(){if(t(a.x,a.y,m,m,r),a.x+=n.x,a.y+=n.y,(a.y<=0||a.y>=h-1)&&(n.y*=-1,a.y=E.clip(a.y,0,h-1)),a.x>=e.x&&a.x<e.x+q&&a.y>=e.y&&a.y<e.y+f?(n.x=1,s++,B()):a.x>=b.x-m+1&&a.x<b.x+q&&a.y>=b.y&&a.y<b.y+f&&(n.x=-1),a.x<0||a.x>=u){k=!0,J();return}z()}function l(a){t(e.x,e.y,q,f,r),e.y+=a,e.y=E.clip(e.y,0,h-f),p(e,i)}function O(){a={x:Math.floor(u/2),y:Math.floor(h/2)};const b=Math.random()>.5?1:-1;const c=Math.random()>.5?1:-1;n={x:b,y:c}}function x(){g.clear(),s=0,k=!1,e={x:4,y:Math.floor(h/2)-Math.floor(f/2)},b={x:u-8,y:Math.floor(h/2)-Math.floor(f/2)},O(),I(),o&&clearInterval(o),o=setInterval(K,G)}function C(){o&&clearInterval(o),w&&clearInterval(w),k=!0,g.clear(),E.reboot()}const y={};const D='Pip-Pong';const F='1.2.0';const d=g.getWidth();const c=g.getHeight();const j=8;const u=Math.floor(d/j);const h=Math.floor(c/j);const f=5;const q=4;const m=1;const G=100;const v='#0F0';const H='#F00';const r='#000';const i='#FFF';let a,e,b,n;let o,w;let k=!1;let s=0;return y.run=function(){g.clear(),g.setColor(v),g.setFont('6x8',4),g.drawString(D,d/2,c/2-20),g.setColor(i),g.setFont('6x8',2),g.drawString('Press   to START',d/2,c/2+15),g.setFont('6x8',1),g.drawString(' v'+F,d/2-5,c-20),A(d/2-20,c/2+15,2.5);const a=setInterval(()=>{BTN_PLAY.read()&&(clearInterval(a),x())},100);Pip.removeAllListeners('knob1'),Pip.on('knob1',function(a){if(k){a===0&&x();return}a<0?l(1):a>0&&l(-1)}),Pip.removeAllListeners('knob2'),Pip.on('knob2',function(a){if(k)return;a<0?l(1):a>0&&l(-1)}),setWatch(()=>{C()},BTN_TORCH,{repeat:!0,edge:'rising',debounce:10})},y}PipPong().run()