function PipSnake(){function m(c,d,e){g.setColor(e);const a=c*i+f;const b=d*i+h;g.fillRect(a,b,a+i-1,b+i-1)}function v(e,f,h){g.setColor('#FFF');const d=2*h;const c=4*h;const i=3*h;const j=1*h;const a=c*.707;const b=(a,b)=>g.fillRect(e+a-d/2,f+b-d/2,e+a+d/2,f+b+d/2);b(-c,0),b(c,0),b(0,-c),b(0,c),b(-a,-a),b(a,-a),b(-a,a),b(a,a),g.fillCircle(e,f,i),g.setColor('#000'),g.fillCircle(e,f,j)}function w(){const a=120;const d=(c-a)/2;const e=b-26;g.clearRect(d,e,d+a,b),g.setColor(k),g.setFont('6x8',2),g.drawString('Score: '+p,c/2,b-20)}function B(){C(),F()}function C(){BTN_TUNEDOWN.read()?a=(a+3)%4:BTN_TUNEUP.read()?a=(a+1)%4:BTN_TORCH.read()?D():BTN_PLAY.read()&&q()}function q(){e=[{x:5,y:5}],a=0,d={x:8,y:5},j=!1,p=0,x(),g.clear(),m(d.x,d.y,s),w(),e.forEach(a=>m(a.x,a.y,k)),l&&clearInterval(l),l=setInterval(B,A)}function x(){let a,b,c;do a=Math.floor(Math.random()*(n-f*2))+f,b=Math.floor(Math.random()*(o-h*2))+h,c=e.some(c=>c.x===a&&c.y===b);while(c);d.x=a,d.y=b}function D(){l&&clearInterval(l),j=!0,g.clear(),E.reboot()}function F(){if(j)return;const i={x:e[0].x+u[a].x,y:e[0].y+u[a].y};if(i.x<f&&(i.x=n-1-f),i.x>=n-f&&(i.x=f),i.y<h&&(i.y=o-1-h),i.y>=o-h&&(i.y=h),e.some(a=>a.x===i.x&&a.y===i.y)){j=!0,g.clear(),g.setColor(k),g.setFont('6x8',4),g.drawString('GAME OVER',c/2,b/2-30),g.setColor(t),g.setFont('6x8',2),g.drawString('Press  to restart',c/2,b/2+10),v(c/2-31,b/2+10,1.5);return}e.unshift(i);const l=i.x===d.x&&i.y===d.y;if(l)p++,x();else{const a=e.pop();m(a.x,a.y,'#000')}m(i.x,i.y,k),m(d.x,d.y,s),w()}const r={};const y='Pip-Snake';const z='1.2.0';const c=g.getWidth();const b=g.getHeight();const i=16;const n=Math.floor(c/ i);const o=Math.floor(b/ i);const f=3;const h=0;const A=200;const k='#0F0';const s='#F00';const t='#FFF';const u=[{x:1,y:0},{x:0,y:1},{x:-1,y:0},{x:0,y:-1}];let e=0;let a=0;let d=0;let j=0;let l=0;let p=0;return r.run=function(){g.clear(),g.setColor(k),g.setFont('6x8',4),g.drawString(y,c/2,b/2-20),g.setColor(t),g.setFont('6x8',2),g.drawString('Press   to START',c/2,b/2+15),g.setFont('6x8',1),g.drawString(' v'+z,c/2-5,b-20),v(c/2-20,b/2+15,2.5),g.setFont('6x8',1);const d=setInterval(()=>{BTN_PLAY.read()&&(clearInterval(d),q())},100);Pip.removeAllListeners('knob1'),Pip.on('knob1',function(b){if(j&&b===0)return q();b<0?a=(a+3)%4:b>0&&(a=(a+1)%4)}),Pip.removeAllListeners('knob2'),Pip.on('knob2',function(b){if(j)return;b<0?a=(a+3)%4:b>0&&(a=(a+1)%4)})},r}PipSnake().run()