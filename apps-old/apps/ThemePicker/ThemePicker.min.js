function readThemeFile(){try{fs.readdirSync(themeSettingsFolder)}catch(a){fs.mkdir(themeSettingsFolder);return}try{let b=fs.readFileSync(themeSettingsFile);let a=JSON.parse(b);theme0=a.theme0,theme1=a.theme1,gradient=a.gradient}catch(a){return}}function writeThemeFile(){try{fs.readdirSync(themeSettingsFolder)}catch(a){fs.mkdir(themeSettingsFolder)}let a={gradient:gradient,theme0:theme0,theme1:theme1};let b=JSON.stringify(a);fs.writeFile(themeSettingsFile,b)}function resetTheme(){try{fs.unlink(themeSettingsFile)}catch(a){}}function drawBlocks(){let a=-120;if(gradient)for(i=0;i<16;i++){let b=0;g.setColor(((theme1[0]-theme0[0])*b+theme0[0])*i/16,((theme1[1]-theme0[1])*b+theme0[1])*i/16,((theme1[2]-theme0[2])*b+theme0[2])*i/16),g.fillRect(SCREEN_WIDTH/2-a,SCREEN_HEIGHT/2-20,SCREEN_WIDTH/2-a+16,SCREEN_HEIGHT/2-4),b=.33,g.setColor(((theme1[0]-theme0[0])*b+theme0[0])*i/16-i*.2/16,((theme1[1]-theme0[1])*b+theme0[1])*i/16-i*.2/16,((theme1[2]-theme0[2])*b+theme0[2])*i/16-i*.2/16),g.fillRect(SCREEN_WIDTH/2-a,SCREEN_HEIGHT/2+-4,SCREEN_WIDTH/2-a+16,SCREEN_HEIGHT/2+12),b=1,g.setColor(((theme1[0]-theme0[0])*b+theme0[0])*i/16+i*.2/16,((theme1[1]-theme0[1])*b+theme0[1])*i/16+i*.2/16,((theme1[2]-theme0[2])*b+theme0[2])*i/16+i*.2/16),g.fillRect(SCREEN_WIDTH/2-a,SCREEN_HEIGHT/2+12,SCREEN_WIDTH/2-a+16,SCREEN_HEIGHT/2+28),b=.66,g.setColor(((theme1[0]-theme0[0])*b+theme0[0])*i/16-i*.4/16,((theme1[1]-theme0[1])*b+theme0[1])*i/16-i*.4/16,((theme1[2]-theme0[2])*b+theme0[2])*i/16-i*.4/16),g.fillRect(SCREEN_WIDTH/2-a,SCREEN_HEIGHT/2+28,SCREEN_WIDTH/2-a+16,SCREEN_HEIGHT/2+44),a+=16}else for(i=0;i<16;i++)g.setColor(theme0[0]*i/16,theme0[1]*i/16,theme0[2]*i/16),g.fillRect(SCREEN_WIDTH/2-a,SCREEN_HEIGHT/2-20,SCREEN_WIDTH/2-a+16,SCREEN_HEIGHT/2-4),g.setColor(theme0[0]*i/16-i*.2/16,theme0[1]*i/16-i*.2/16,theme0[2]*i/16-i*.2/16),g.fillRect(SCREEN_WIDTH/2-a,SCREEN_HEIGHT/2+-4,SCREEN_WIDTH/2-a+16,SCREEN_HEIGHT/2+12),g.setColor(theme0[0]*i/16+i*.2/16,theme0[1]*i/16+i*.2/16,theme0[2]*i/16+i*.2/16),g.fillRect(SCREEN_WIDTH/2-a,SCREEN_HEIGHT/2+12,SCREEN_WIDTH/2-a+16,SCREEN_HEIGHT/2+28),g.setColor(theme0[0]*i/16-i*.4/16,theme0[1]*i/16-i*.4/16,theme0[2]*i/16-i*.4/16),g.fillRect(SCREEN_WIDTH/2-a,SCREEN_HEIGHT/2+28,SCREEN_WIDTH/2-a+16,SCREEN_HEIGHT/2+44),a+=16}function draw(){if(g.clear(),g.setFontMonofonto18(),g.setColor(theme0[0],theme0[1],theme0[2]),g.drawString('Select the primary color of the theme',SCREEN_WIDTH/2,SCREEN_HEIGHT/2-110),g.drawString('Move the tuner up to toggle 1 or 2 colours.',SCREEN_WIDTH/2,SCREEN_HEIGHT/2-90),gradient)switch(selected){case 0:g.drawString('1: R*:'+theme0[0]+'G:'+theme0[1]+'B:'+theme0[2]+'   2: R:'+theme1[0]+'G:'+theme1[1]+'B:'+theme1[2],SCREEN_WIDTH/2,SCREEN_HEIGHT/2-50);break;case 1:g.drawString('1: R:'+theme0[0]+'G*:'+theme0[1]+'B:'+theme0[2]+'   2: R:'+theme1[0]+'G:'+theme1[1]+'B:'+theme1[2],SCREEN_WIDTH/2,SCREEN_HEIGHT/2-50);break;case 2:g.drawString('1: R:'+theme0[0]+'G:'+theme0[1]+'B*:'+theme0[2]+'   2: R:'+theme1[0]+'G:'+theme1[1]+'B:'+theme1[2],SCREEN_WIDTH/2,SCREEN_HEIGHT/2-50);break;case 3:g.drawString('1: R:'+theme0[0]+'G:'+theme0[1]+'B:'+theme0[2]+'   2: R*:'+theme1[0]+'G:'+theme1[1]+'B:'+theme1[2],SCREEN_WIDTH/2,SCREEN_HEIGHT/2-50);break;case 4:g.drawString('1: R:'+theme0[0]+'G:'+theme0[1]+'B:'+theme0[2]+'   2: R:'+theme1[0]+'G*:'+theme1[1]+'B:'+theme1[2],SCREEN_WIDTH/2,SCREEN_HEIGHT/2-50);break;case 5:g.drawString('1: R:'+theme0[0]+'G:'+theme0[1]+'B:'+theme0[2]+'   2: R:'+theme1[0]+'G:'+theme1[1]+'B*:'+theme1[2],SCREEN_WIDTH/2,SCREEN_HEIGHT/2-50);break;default:break}else switch(selected){case 0:g.drawString('R*:'+theme0[0]+'G:'+theme0[1]+'B:'+theme0[2],SCREEN_WIDTH/2,SCREEN_HEIGHT/2-50);break;case 1:g.drawString('R:'+theme0[0]+'G*:'+theme0[1]+'B:'+theme0[2],SCREEN_WIDTH/2,SCREEN_HEIGHT/2-50);break;case 2:g.drawString('R:'+theme0[0]+'G:'+theme0[1]+'B*:'+theme0[2],SCREEN_WIDTH/2,SCREEN_HEIGHT/2-50);break;default:break}g.drawString('Press wheel in to save and reboot',SCREEN_WIDTH/2,SCREEN_HEIGHT/2+90),g.drawString('Press torch to reset theme and reboot',SCREEN_WIDTH/2,SCREEN_HEIGHT/2+110)}function gracefulClose(){clearInterval(intervalId),Pip.removeListener('knob1',handleKnob1),Pip.removeListener('knob2',handleKnob2),Pip.removeListener('torch',handleTorch),E.reboot()}function handleKnob1(a){if(Pip.knob1Click(a),a==0)gradient!=gradient,writeThemeFile(),gracefulClose();else if(gradient&&selected>2){if(theme1[selected%3]+=a*.01,theme1[selected%3]<0){theme1[selected%3]=0;return}if(theme1[selected%3]>1){theme1[selected%3]=1;return}}else{if(theme0[selected]+=a*.01,theme0[selected]<0){theme0[selected]=0;return}if(theme0[selected]>1){theme0[selected]=1;return}}draw()}function handleKnob2(a){if(Pip.knob2Click(a),selected+=a,selected<0){selected=0;return}if(!gradient&&selected>2){selected=2;return}if(gradient&&selected>5){selected=5;return}draw()}function handleTorch(){resetTheme(),gracefulClose()}function checkTuner(){BTN_TUNEUP.read()&&(gradient=!gradient,draw())}let theme0=[1,1,1];let theme1=[1,1,1];let selected=0;let gradient=!1;const SCREEN_WIDTH=g.getWidth();const SCREEN_HEIGHT=g.getHeight();const themeSettingsFolder='USER/ThemePicker';const themeSettingsFile='USER/ThemePicker/theme.json';Pip.on('knob1',handleKnob1),Pip.on('knob2',handleKnob2),Pip.on('torch',handleTorch),readThemeFile(),draw();let intervalId=setInterval(()=>{checkMode(),Pip.mode!=2?gracefulClose():(drawBlocks(),checkTuner())},250)