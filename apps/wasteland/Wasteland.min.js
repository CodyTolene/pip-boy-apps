function Wasteland(){function B(){const a=[1,5,10,15,20];const b=a.findIndex(a=>a===Pip.brightness);const c=(b+1)%a.length;Pip.brightness=a[c],Pip.updateBrightness()}function j(){bC.clear(1);for(let b=0;b<h;b++){const m=(b-h/2)/h*w;const d=a.angle+m;const n=Math.cos(d);const o=Math.sin(d);let c=0,e=a.x,f=a.y;while(c<x&&!l(e,f))e+=n*k,f+=o*k,c+=k;const g=Math.min(i,i/(c+.1));const p=c<2?3:c<4?2:1;const j=A+b*z;bC.setColor(p),bC.drawLine(j,(i-g)/2,j,(i+g)/2)}bC.flip()}function C(e,f,h){g.setColor('#FFF');const d=2*h;const c=4*h;const i=3*h;const j=1*h;const a=c*.707;const b=(a,b)=>g.fillRect(e+a-d/2,f+b-d/2,e+a+d/2,f+b+d/2);b(-c,0),b(c,0),b(0,-c),b(0,c),b(-a,-a),b(a,-a),b(-a,a),b(a,a),g.fillCircle(e,f,i),g.setColor('#000'),g.fillCircle(e,f,j)}function D(){c&&(clearInterval(c),c=null),d&&(clearInterval(d),d=null),bC.clear(1).flip(),E.reboot()}function l(d,e){const c=Math.floor(d);const a=Math.floor(e);return b[a]&&b[a][c]==='#'}function F(){const d=Math.cos(a.angle);const e=Math.sin(a.angle);const b=a.x-d;const c=a.y-e;l(b,c)?Pip.audioStart('USER/OOF.wav'):(a.x=b,a.y=c,Pip.audioStart('USER/F_STEP.wav')),j()}function G(){const d=Math.cos(a.angle);const e=Math.sin(a.angle);const b=a.x+d;const c=a.y+e;l(b,c)?Pip.audioStart('USER/OOF.wav'):(a.x=b,a.y=c,Pip.audioStart('USER/F_STEP.wav')),j()}function r(b){a.angle+=Math.PI/4*b,a.angle<0?a.angle+=Math.PI*2:a.angle>Math.PI*2&&(a.angle-=Math.PI*2),Pip.audioStart('USER/F_STEP_2.wav'),j()}const m={};const s='Wasteland';const t='1.2.1';const e=g.getWidth();const f=g.getHeight();const u='#0F0';const v='#FFF';const b=['###################','#                 #','#                 #','#   ####   ####   #','#                 #','#        V        #','#                 #','#   ###########   #','#                 #','#                 #','###################'];const h=13;const w=Math.PI/3;const x=8;const k=.2;const n=150;const y=g.getWidth()-n;const i=g.getHeight();const z=Math.floor(y/h);const A=n/3;const a={x:1,y:1,angle:0,speed:1};let c=null;let d=null;const o='knob1';const p='knob2';const q='torch';for(let g=0;g<b.length;g++){const c=b[g].indexOf('V');if(c!==-1){a.x=c+.5,a.y=g+.5,b[g]=b[g].substring(0,c)+' '+b[g].substring(c+1);break}}return m.run=function(){g.clear(),g.setColor(u),g.setFont('6x8',4),g.drawString(s,e/2,f/2-20),g.setColor(v),g.setFont('6x8',2),g.drawString('Press   to START',e/2,f/2+15),g.setFont('6x8',1),g.drawString(' v'+t,e/2-5,f-20),C(e/2-20,f/2+15,2.5),g.setFont('6x8',1),d=setInterval(()=>{BTN_PLAY.read()&&(d&&(clearInterval(d),d=null),j(),Pip.removeAllListeners(o),Pip.on(o,function(a){a===0?F():r(a)}),Pip.removeAllListeners(p),Pip.on(p,function(a){r(a)}),c&&(clearInterval(c),c=null),c=setInterval(()=>{BTN_PLAY.read()&&G()},100))},100),Pip.removeAllListeners(q),Pip.on(q,function(){B()}),setWatch(()=>D(),BTN_POWER,{debounce:50,edge:'rising',repeat:!0})},m}Wasteland().run()