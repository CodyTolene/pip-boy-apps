function FileExplorer(){function A(a,b){return a==='/'||a===''?'/'+b:a+'/'+b}function e(){g.clear(),g.setColor(p),g.setFont('6x8',2),g.drawString(y+' v'+z,h/2,20),g.setColor(j),g.setFont('6x8',1);let e=c.slice(b,b+t);e.forEach(function(c,l){let m=b+l===a;g.setColor(m?p:j);let e='';let n=c.name==='..'?c.depth:c.depth-v.split('/').length+1;for(let a=0;a<Math.max(0,n);a++)e+='...';let o=c.type==='dir'?'[DIR] ':'[FILE] ';let f=e+o+c.name;let h=g.stringWidth(f);let i=60+h/2;let k=r+l*q;g.drawString(f,i,k),c.path===d&&g.drawString(' (PLAYING)',i+h+4,k)})}function w(d){try{let g=fs.readdir(d)||[];let f=d.split('/').length-1;v=d,c=[],d!==k&&c.push({name:'..',path:d.split('/').slice(0,-1).join('/')||'/',type:'dir',depth:f-1}),g.forEach(b=>{let a=A(d,b);if(u&&(b==='.'||b==='..'||a.includes('/./')||a.includes('/../')))return;let e='file';try{fs.readdir(a),e='dir'}catch(a){}c.push({name:b,path:a,type:e,depth:f})}),a=0,b=0,e()}catch(a){console.log('Failed to load dir:',d)}}function l(){f&&(Pip.videoStop(),f=!1,e())}function m(){l(),a>0&&a--,a<b&&b--,e()}function n(){l(),a<c.length-1&&a++,a>=b+t&&b++,e()}function x(){const b=c[a];if(!b)return;if(b.type==='dir'){w(b.path);return}const g=b.name.toLowerCase();if(f){l();return}if(g.endsWith('.wav')){d===b.path?(Pip.audioStop(),d=null,e()):(Pip.audioStop(),Pip.audioStart(b.path),d=b.path,e());return}if(g.endsWith('.avi')){Pip.audioStop(),Pip.videoStart(b.path,{x:40,y:0}),f=!0,d=null;return}if(g.endsWith('.holotape')){Pip.loadApp(b.path);return}}function B(){if(BTN_TUNEUP.read()&&m(),BTN_TUNEDOWN.read()&&n(),BTN_PLAY.read()&&x(),BTN_TORCH.read()){const a=[1,5,10,15,20];const b=a.findIndex(a=>a===Pip.brightness);const c=(b+1)%a.length;Pip.brightness=a[c],Pip.updateBrightness()}}function C(){Pip.audioStop(),Pip.videoStop(),d=null,f=!1,bC.clear(1).flip(),E.reboot()}function D(){g.clear(),g.setFont('6x8',2),g.setColor(j),g.drawString('Loading...',h/2,i/2)}const o={};const y='File Explorer';const z='2.1.3';const h=g.getWidth();const i=g.getHeight();const p='#0F0';const j='#FFF';const q=12;const r=40;const t=Math.floor((i-r)/q);const k='/';let c=[];let a=0;let b=0;let d=null;let f=!1;let u=!1;let v=k;try{const a=s.list();if(a.includes('VERSION')&&a.includes('.bootcde')){const a=s.read('VERSION')||'';const b=parseFloat(a);u=b>=1.29}}catch(a){console.log('Failed to detect JS version:',a)}return o.run=function(){if(!Pip.isSDCardInserted()){g.clear(),g.setFont('6x8',2),g.setColor('#F00'),g.drawString('NO SD CARD DETECTED',h/2,i/2);return}D(),setTimeout(function(){w(k),setInterval(B,150)},50),Pip.removeAllListeners('knob1'),Pip.on('knob1',function(a){a<0?n():a>0?m():x()}),Pip.removeAllListeners('knob2'),Pip.on('knob2',function(a){a<0?m():a>0&&n()}),setWatch(()=>C(),BTN_POWER,{debounce:50,edge:'rising',repeat:!0})},o}const fs=require('fs');const s=require('Storage');FileExplorer().run()