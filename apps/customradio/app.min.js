function CustomRadio(){function K(){t&&clearInterval(t),t=null}function x(){g.setColor(I).fillRect(k)}function Y(){m&&clearInterval(m),m=null,j=null,e&&(e=null,E.defrag())}function r(){if(T===!1)return;s(a),s(b),s(k),s(U),s(n),M()}function Z(){const d=P.toUpperCase();const e='v'+Q;const c=5;const f=g.stringWidth(d);g.setColor(q).setFontAlign(-1,-1,0).setFontMonofonto16().drawString(d,b.x1,a.y1+8),g.setColor(u).setFontAlign(-1,-1,0).setFont('6x8').drawString(e,b.x1+f+c,a.y1+16),g.setColor(J).drawLine(b.x1,b.y1-c,b.x2,b.y1-c)}function s(a){g.setColor(J).drawRect(a.x1,a.y1,a.x2,a.y2)}function _(){K(),t=setInterval(()=>{drawFooter()},X)}function $(b){if(!b)throw new Error('No song provided to drawNowPlaying');const a=b.replace(/\.wav$/i,'');const c=a.length>19?a.slice(0,16)+'...':a;g.setColor(q).setFontAlign(1,-1,0).setFontMonofonto16().drawString(c,k.x2,k.y1+20)}function a0(){g.setColor(u).setFontAlign(1,1,0).setFont('6x8').drawString('Now Playing',k.x2,k.y1+15)}function L(){const a=f*i;const h=c.slice(a,a+i);g.setColor(I).fillRect(b),g.setFontMonofonto16().setFontAlign(-1,-1,0);const e=5;const j=20;h.forEach((i,c)=>{const f=b.y1+c*j+e;const a=i.replace(/\.wav$/i,'');const h=a.length>19?a.slice(0,16)+'...':a;g.setColor(c===d?q:u).drawString(h,b.x1+e,f,!0)}),r()}function M(){const d=5;const h=3;const e=n.x1;const c=n.y1;const b=n.x2;const i=n.y2;const a=i-1;const f=b;for(let j=0;j<40;j++){const k=j%d===0?q:u;const b=j%d===0?2:1;const i=e+j*h;const l=a-b;g.setColor(k),g.drawLine(i,l,i,a),g.drawLine(f-b,c+j*3,f,c+j*3)}g.setColor(q),g.drawLine(e,a,b,a),g.drawLine(b,a,b,c)}function a1(){w=0,e=Graphics.createArrayBuffer(120,120,2,{msb:!0}),E.getAddressOf(e,0)===0&&(e=undefined,E.defrag(),e=Graphics.createArrayBuffer(120,120,2,{msb:!0})),j=new Uint16Array(60);for(let a=0;a<60;a+=2)j[a]=a*2;m&&clearInterval(m),m=setInterval(()=>{if(!e)return;if(e.clearRect(0,0,119,119),Pip.radioClipPlaying)Pip.getAudioWaveform(j,20,100);else if(Pip.radioOn&&(typeof RADIO_AUDIO)[0]!='u')for(let a=1;a<60;a+=2)j[a]=E.clip(60+(analogRead(RADIO_AUDIO)-.263)*600,0,119);else{let a=w;for(let b=1;b<60;b+=2)j[b]=60+Math.sin(a)*45*Math.sin((a+=.6)*.13)}e.drawPolyAA(j),w+=.3,Pip.blitImage(e,285,75,{noScanEffect:!0})},W)}function a2(e){let b=Date.now();if(b-F<V)return;if(F=b,e!==0)return N(e*-1);const g=f*i;const a=c[g+d];if(!a)return;const j='/'+H+a;a==='RANDOM'?l?(l=!1,v()):h!==null?(l=!0,nextSongToPlay='RANDOM',v()):(l=!0,o=c.slice(1).sort(()=>Math.random()-.5),p=0,y()):h===j?(nextSongToPlay=null,v()):(l=!1,nextSongToPlay=a,h!==null?v():(z(nextSongToPlay),nextSongToPlay=null))}function a3(){K(),Y(),O(),bC.clear(1).flip(),E.reboot()}function a4(a){N(a)}function a5(){const a=[1,5,10,15,20];const b=a.findIndex(a=>a===Pip.brightness);const c=(b+1)%a.length;Pip.brightness=a[c],Pip.updateBrightness()}function a6(){if(l)y();else if(nextSongToPlay){const a=nextSongToPlay;nextSongToPlay=null,a==='RANDOM'?(o=c.slice(1).sort(()=>Math.random()-.5),p=0,y()):z(a)}else h=null,Pip.radioClipPlaying=!1,x(),r()}function a7(){try{c=fs.readdir('/RADIO').filter(a=>a.endsWith('.wav')).sort(),print('Loaded '+c.length+' songs:'),c.unshift('RANDOM')}catch(a){print('Failed to load songs:',a),c=[]}f=0,d=0,L()}function N(g){const a=f*i;const b=c.slice(a,a+i);const e=Math.floor((c.length-1)/ i);d+=g,d<0?f>0?(f--,d=i-1):d=0:d>=b.length&&(f<e?(f++,d=0):d=b.length-1),L()}function y(){p>=o.length&&(o=c.slice(1).sort(()=>Math.random()-.5),p=0),z(o[p++])}function z(a){h='/'+H+a,Pip.audioStart(h),Pip.radioClipPlaying=!0,x(),a0(),$(a),r()}function O(){Pip.removeAllListeners(B),Pip.removeAllListeners(C),Pip.removeAllListeners(D),Pip.removeAllListeners(G)}function a8(){Pip.on(B,a2),Pip.on(C,a4),Pip.on(D,a5),Pip.on(G,a6),setWatch(()=>a3(),BTN_POWER,{debounce:50,edge:'rising',repeat:!0})}function v(){Pip.audioStop(),h=null,Pip.radioClipPlaying=!1,x(),r()}const A={};const P='Custom Radio';const Q='3.1.0';const R=g.getWidth();const S=g.getHeight();const T=!1;const a={x1:60,y1:40,x2:R-60,y2:S-20};const b={x1:a.x1+10,y1:a.y1+30,x2:(a.x2+a.x1)/2,y2:a.y2-20};const U={x1:b.x2+10,y1:a.y1+30,x2:a.x2-10,y2:a.y2-20};const k={x1:b.x2+10,y1:a.y2-100,x2:a.x2-10,y2:a.y2-60};const n={x1:b.x2+45,y1:a.y1+37,x2:a.x2-12,y2:a.y2-101};const B='knob1';const C='knob2';const D='torch';const V=10;let F=0;const G='audioStopped';const H='RADIO/';let h=null;const i=10;let f=0;let d=0;let c=[];let l=!1;let o=[];let p=0;const W=50;let w=0;let e=null;let m=null;let j=null;const X=49.99923706054;let t=null;const I='#000000';const q='#00ff00';const u='#007f00';const J='#003300';return A.run=function(){bC.clear(1).flip(),Pip.mode=MODE.RADIO,drawHeader(Pip.mode),O(),a8(),a7(),a1(),M(),Z(),_(),r()},A}CustomRadio().run()