function CustomRadio(){function w(){g.setColor(H).fillRect(k)}function U(){m&&clearInterval(m),m=null,j=null,e&&(e=null,E.defrag())}function r(){if(R===!1)return;s(a),s(b),s(k),s(S),s(n),K()}function V(){const d=N.toUpperCase();const e='v'+O;const c=5;const f=g.stringWidth(d);g.setColor(q).setFontAlign(-1,-1,0).setFontMonofonto16().drawString(d,b.x1,a.y1+8),g.setColor(t).setFontAlign(-1,-1,0).setFont('6x8').drawString(e,b.x1+f+c,a.y1+16),g.setColor(I).drawLine(b.x1,b.y1-c,b.x2,b.y1-c)}function s(a){g.setColor(I).drawRect(a.x1,a.y1,a.x2,a.y2)}function W(b){if(!b)throw new Error('No song provided to drawNowPlaying');const a=b.replace(/\.wav$/i,'');const c=a.length>19?a.slice(0,16)+'...':a;g.setColor(q).setFontAlign(1,-1,0).setFontMonofonto16().drawString(c,k.x2,k.y1+20)}function X(){g.setColor(t).setFontAlign(1,1,0).setFont('6x8').drawString('Now Playing',k.x2,k.y1+15)}function J(){const a=f*i;const h=c.slice(a,a+i);g.setColor(H).fillRect(b),g.setFontMonofonto16().setFontAlign(-1,-1,0);const e=5;const j=20;h.forEach((i,c)=>{const f=b.y1+c*j+e;const a=i.replace(/\.wav$/i,'');const h=a.length>19?a.slice(0,16)+'...':a;g.setColor(c===d?q:t).drawString(h,b.x1+e,f,!0)}),r()}function K(){const d=5;const h=3;const e=n.x1;const c=n.y1;const b=n.x2;const i=n.y2;const a=i-1;const f=b;for(let j=0;j<40;j++){const k=j%d===0?q:t;const b=j%d===0?2:1;const i=e+j*h;const l=a-b;g.setColor(k),g.drawLine(i,l,i,a),g.drawLine(f-b,c+j*3,f,c+j*3)}g.setColor(q),g.drawLine(e,a,b,a),g.drawLine(b,a,b,c)}function Y(){v=0,e=Graphics.createArrayBuffer(120,120,2,{msb:!0}),E.getAddressOf(e,0)===0&&(e=undefined,E.defrag(),e=Graphics.createArrayBuffer(120,120,2,{msb:!0})),j=new Uint16Array(60);for(let a=0;a<60;a+=2)j[a]=a*2;m&&clearInterval(m),m=setInterval(()=>{if(!e)return;if(e.clearRect(0,0,119,119),Pip.radioClipPlaying)Pip.getAudioWaveform(j,20,100);else if(Pip.radioOn&&(typeof RADIO_AUDIO)[0]!='u')for(let a=1;a<60;a+=2)j[a]=E.clip(60+(analogRead(RADIO_AUDIO)-.263)*600,0,119);else{let a=v;for(let b=1;b<60;b+=2)j[b]=60+Math.sin(a)*45*Math.sin((a+=.6)*.13)}e.drawPolyAA(j),v+=.3,Pip.blitImage(e,285,85,{noScanEffect:!0})},50)}function Z(e){let b=Date.now();if(b-D<T)return;if(D=b,e!==0)return L(e*-1);const g=f*i;const a=c[g+d];if(!a)return;const j='/'+G+a;a==='RANDOM'?l?(l=!1,u()):h!==null?(l=!0,nextSongToPlay='RANDOM',u()):(l=!0,o=c.slice(1).sort(()=>Math.random()-.5),p=0,x()):h===j?(nextSongToPlay=null,u()):(l=!1,nextSongToPlay=a,h!==null?u():(y(nextSongToPlay),nextSongToPlay=null))}function _(a){L(a)}function $(){U(),M(),bC.clear(1).flip(),E.reboot()}function a0(){if(l)x();else if(nextSongToPlay){const a=nextSongToPlay;nextSongToPlay=null,a==='RANDOM'?(o=c.slice(1).sort(()=>Math.random()-.5),p=0,x()):y(a)}else h=null,Pip.radioClipPlaying=!1,w(),r()}function a1(){try{c=fs.readdir('/RADIO').filter(a=>a.endsWith('.wav')).sort(),print('Loaded '+c.length+' songs:'),c.unshift('RANDOM')}catch(a){print('Failed to load songs:',a),c=[]}f=0,d=0,J()}function L(g){const a=f*i;const b=c.slice(a,a+i);const e=Math.floor((c.length-1)/ i);d+=g,d<0?f>0?(f--,d=i-1):d=0:d>=b.length&&(f<e?(f++,d=0):d=b.length-1),J()}function x(){p>=o.length&&(o=c.slice(1).sort(()=>Math.random()-.5),p=0),y(o[p++])}function y(a){h='/'+G+a,Pip.audioStart(h),Pip.radioClipPlaying=!0,w(),X(),W(a),r()}function M(){Pip.removeAllListeners(A),Pip.removeAllListeners(B),Pip.removeAllListeners(C),Pip.removeAllListeners(F)}function a2(){Pip.on(A,Z),Pip.on(B,_),Pip.on(C,$),Pip.on(F,a0)}function u(){Pip.audioStop(),h=null,Pip.radioClipPlaying=!1,w(),r()}const z={};const N='Custom Radio';const O='3.0.0';const P=g.getWidth();const Q=g.getHeight();const R=!1;const a={x1:60,y1:50,x2:P-60,y2:Q-10};const b={x1:a.x1+10,y1:a.y1+30,x2:(a.x2+a.x1)/2,y2:a.y2-20};const S={x1:b.x2+10,y1:a.y1+30,x2:a.x2-10,y2:a.y2-20};const k={x1:b.x2+10,y1:a.y2-100,x2:a.x2-10,y2:a.y2-60};const n={x1:b.x2+45,y1:a.y1+37,x2:a.x2-12,y2:a.y2-101};const A='knob1';const B='knob2';const C='torch';const T=10;let D=0;const F='audioStopped';const G='RADIO/';let h=null;const i=10;let f=0;let d=0;let c=[];let l=!1;let o=[];let p=0;let v=0;let e=null;let m=null;let j=null;const H='#000000';const q='#00ff00';const t='#007f00';const I='#003300';return z.run=function(){bC.clear(1).flip(),Pip.mode=MODE.RADIO,drawHeader(Pip.mode),M(),a2(),a1(),Y(),K(),V(),r()},z}CustomRadio().run()