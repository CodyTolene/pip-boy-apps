function CustomRadio(){function B(){g.setColor(z).fillRect(j)}function P(){k&&clearInterval(k),k=null,i=null,d&&(d=null,E.defrag())}function q(){if(M===!1)return;n(a),n(b),n(j),n(N),n(l),D()}function Q(){const d=I.toUpperCase();const e='v'+J;const c=5;const f=g.stringWidth(d);g.setColor(m).setFontAlign(-1,-1,0).setFontMonofonto16().drawString(d,b.x1,a.y1+8),g.setColor(p).setFontAlign(-1,-1,0).setFont('6x8').drawString(e,b.x1+f+c,a.y1+16),g.setColor(A).drawLine(b.x1,b.y1-c,b.x2,b.y1-c)}function n(a){g.setColor(A).drawRect(a.x1,a.y1,a.x2,a.y2)}function R(b){if(!b)throw new Error('No song provided to drawNowPlaying');const a=b.replace(/\.wav$/i,'');const c=a.length>19?a.slice(0,16)+'...':a;g.setColor(m).setFontAlign(1,-1,0).setFontMonofonto16().drawString(c,j.x2,j.y1+20)}function S(){g.setColor(p).setFontAlign(1,1,0).setFont('6x8').drawString('Now Playing',j.x2,j.y1+15)}function C(){const a=e*f;const i=h.slice(a,a+f);g.setColor(z).fillRect(b),g.setFontMonofonto16().setFontAlign(-1,-1,0);const d=5;const j=20;i.forEach((i,e)=>{const f=b.y1+e*j+d;const a=i.replace(/\.wav$/i,'');const h=a.length>19?a.slice(0,16)+'...':a;g.setColor(e===c?m:p).drawString(h,b.x1+d,f,!0)}),q()}function D(){const d=5;const h=3;const e=l.x1;const c=l.y1;const b=l.x2;const i=l.y2;const a=i-1;const f=b;for(let j=0;j<40;j++){const k=j%d===0?m:p;const b=j%d===0?2:1;const i=e+j*h;const l=a-b;g.setColor(k),g.drawLine(i,l,i,a),g.drawLine(f-b,c+j*3,f,c+j*3)}g.setColor(m),g.drawLine(e,a,b,a),g.drawLine(b,a,b,c)}function T(){r=0,d=Graphics.createArrayBuffer(120,120,2,{msb:!0}),E.getAddressOf(d,0)===0&&(d=undefined,E.defrag(),d=Graphics.createArrayBuffer(120,120,2,{msb:!0})),i=new Uint16Array(60);for(let a=0;a<60;a+=2)i[a]=a*2;k&&clearInterval(k),k=setInterval(()=>{if(!d)return;if(d.clearRect(0,0,119,119),Pip.radioClipPlaying)Pip.getAudioWaveform(i,20,100);else if(Pip.radioOn&&(typeof RADIO_AUDIO)[0]!='u')for(let a=1;a<60;a+=2)i[a]=E.clip(60+(analogRead(RADIO_AUDIO)-.263)*600,0,119);else{let a=r;for(let b=1;b<60;b+=2)i[b]=60+Math.sin(a)*45*Math.sin((a+=.6)*.13)}d.drawPolyAA(i),r+=.3,Pip.blitImage(d,285,85,{noScanEffect:!0})},50)}function U(b){let a=Date.now();if(a-w<O)return;if(w=a,b===0){const b=e*f;const a=h[b+c];if(!a)return;o==='/'+y+a?H():Y(a)}else F(b*-1)}function V(a){F(a)}function W(){P(),G(),bC.clear(1).flip(),E.reboot()}function X(){try{h=fs.readdir('/RADIO').filter(a=>a.endsWith('.wav')).sort(),print('Loaded '+h.length+' songs:')}catch(a){print('Failed to load songs:',a),h=[]}e=0,c=0,C()}function F(g){const a=e*f;const b=h.slice(a,a+f);const d=Math.floor((h.length-1)/f);c+=g,c<0?e>0?(e--,c=f-1):c=0:c>=b.length&&(e<d?(e++,c=0):c=b.length-1),C()}function Y(a){Pip.audioStop(),o='/'+y+a,Pip.audioStart(o),Pip.radioClipPlaying=!0,B(),S(),R(a),q()}function G(){Pip.removeAllListeners(t),Pip.removeAllListeners(u),Pip.removeAllListeners(v),Pip.removeAllListeners(x)}function Z(){Pip.on(t,U),Pip.on(u,V),Pip.on(v,W),Pip.on(x,H)}function H(){Pip.audioStop(),o=null,Pip.radioClipPlaying=!1,B(),q()}const s={};const I='Custom Radio';const J='3.0.0';const K=g.getWidth();const L=g.getHeight();const M=!1;const a={x1:60,y1:50,x2:K-60,y2:L-10};const b={x1:a.x1+10,y1:a.y1+30,x2:(a.x2+a.x1)/2,y2:a.y2-20};const N={x1:b.x2+10,y1:a.y1+30,x2:a.x2-10,y2:a.y2-20};const j={x1:b.x2+10,y1:a.y2-100,x2:a.x2-10,y2:a.y2-60};const l={x1:b.x2+45,y1:a.y1+37,x2:a.x2-12,y2:a.y2-101};const t='knob1';const u='knob2';const v='torch';const O=100;let w=0;const x='audioStopped';const y='RADIO/';let o=null;const f=10;let e=0;let c=0;let h=[];let r=0;let d=null;let k=null;let i=null;const z='#000000';const m='#00ff00';const p='#007f00';const A='#003300';return s.run=function(){bC.clear(1).flip(),Pip.mode=MODE.RADIO,drawHeader(Pip.mode),G(),Z(),X(),T(),D(),Q(),q()},s}CustomRadio().run()