function CustomRadio(){function A(){g.setColor(z).fillRect(j)}function P(){k&&clearInterval(k),k=null,i=null,c&&(c=null,E.defrag())}function q(){if(J===!1)return;n(a),n(d),n(j),n(M),n(l),C()}function Q(){const b=H.toUpperCase();const c='v'+I;const e=g.stringWidth(b);g.setColor(m).setFontAlign(-1,-1,0).setFontMonofonto16().drawString(b,d.x1,a.y1+8),g.setColor(p).setFontAlign(-1,-1,0).setFont('6x8').drawString(c,d.x1+e+5,a.y1+16)}function n(a){g.setColor(O).drawRect(a.x1,a.y1,a.x2,a.y2)}function R(b){if(!b)throw new Error('No song provided to drawNowPlaying');const a=b.replace(/\.wav$/i,'');const c=a.length>19?a.slice(0,16)+'...':a;g.setColor(m).setFontAlign(1,-1,0).setFontMonofonto16().drawString(c,j.x2,j.y1+20)}function S(){g.setColor(p).setFontAlign(1,1,0).setFont('6x8').drawString('Now Playing',j.x2,j.y1+15)}function B(){const a=e*f;const c=h.slice(a,a+f);g.setColor(z).fillRect(d),g.setFontMonofonto16().setFontAlign(-1,-1,0);const i=10;const j=10;const k=20;c.forEach((h,c)=>{const e=d.y1+c*k+i;const a=h.replace(/\.wav$/i,'');const f=a.length>19?a.slice(0,16)+'...':a;g.setColor(c===b?m:p).drawString(f,d.x1+j,e,!0)}),q()}function C(){const d=5;const h=3;const e=l.x1;const c=l.y1;const b=l.x2;const i=l.y2;const a=i-1;const f=b;for(let j=0;j<40;j++){const k=j%d===0?m:p;const b=j%d===0?2:1;const i=e+j*h;const l=a-b;g.setColor(k),g.drawLine(i,l,i,a),g.drawLine(f-b,c+j*3,f,c+j*3)}g.setColor(m),g.drawLine(e,a,b,a),g.drawLine(b,a,b,c)}function T(){r=0,c=Graphics.createArrayBuffer(120,120,2,{msb:!0}),E.getAddressOf(c,0)===0&&(c=undefined,E.defrag(),c=Graphics.createArrayBuffer(120,120,2,{msb:!0})),i=new Uint16Array(60);for(let a=0;a<60;a+=2)i[a]=a*2;k&&clearInterval(k),k=setInterval(()=>{if(!c)return;if(c.clearRect(0,0,119,119),Pip.radioClipPlaying)Pip.getAudioWaveform(i,20,100);else if(Pip.radioOn&&(typeof RADIO_AUDIO)[0]!='u')for(let a=1;a<60;a+=2)i[a]=E.clip(60+(analogRead(RADIO_AUDIO)-.263)*600,0,119);else{let a=r;for(let b=1;b<60;b+=2)i[b]=60+Math.sin(a)*45*Math.sin((a+=.6)*.13)}c.drawPolyAA(i),r+=.3,Pip.blitImage(c,285,85,{noScanEffect:!0})},50)}function U(c){let a=Date.now();if(a-w<N)return;if(w=a,c===0){const c=e*f;const a=h[c+b];if(!a)return;o==='/'+y+a?G():Y(a)}else D(c*-1)}function V(a){D(a)}function W(){P(),F(),bC.clear(1).flip(),E.reboot()}function X(){try{h=fs.readdir('/RADIO').filter(a=>a.endsWith('.wav')).sort(),print('Loaded '+h.length+' songs:')}catch(a){print('Failed to load songs:',a),h=[]}e=0,b=0,B()}function D(g){const a=e*f;const c=h.slice(a,a+f);const d=Math.floor((h.length-1)/f);b+=g,b<0?e>0?(e--,b=f-1):b=0:b>=c.length&&(e<d?(e++,b=0):b=c.length-1),B()}function Y(a){Pip.audioStop(),o='/'+y+a,Pip.audioStart(o),Pip.radioClipPlaying=!0,A(),S(),R(a),q()}function F(){Pip.removeAllListeners(t),Pip.removeAllListeners(u),Pip.removeAllListeners(v),Pip.removeAllListeners(x)}function Z(){Pip.on(t,U),Pip.on(u,V),Pip.on(v,W),Pip.on(x,G)}function G(){Pip.audioStop(),o=null,Pip.radioClipPlaying=!1,A(),q()}const s={};const H='Custom Radio';const I='3.0.0';const J=!1;const K=g.getWidth();const L=g.getHeight();const a={x1:60,y1:50,x2:K-60,y2:L-10};const d={x1:a.x1+10,y1:a.y1+30,x2:(a.x2+a.x1)/2,y2:a.y2-20};const M={x1:d.x2+10,y1:a.y1+30,x2:a.x2-10,y2:a.y2-20};const j={x1:d.x2+10,y1:a.y2-100,x2:a.x2-10,y2:a.y2-60};const l={x1:d.x2+45,y1:a.y1+37,x2:a.x2-12,y2:a.y2-101};const t='knob1';const u='knob2';const v='torch';const N=100;let w=0;const x='audioStopped';const y='RADIO/';let o=null;const f=10;let e=0;let b=0;let h=[];let r=0;let c=null;let k=null;let i=null;const z='#000000';const m='#00ff00';const p='#007f00';const O='#003300';return s.run=function(){bC.clear(1).flip(),Pip.mode=MODE.RADIO,drawHeader(Pip.mode),F(),Z(),X(),T(),C(),Q(),q()},s}CustomRadio().run()