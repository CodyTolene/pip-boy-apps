function DiceRoller(){function L(){const n=e[c];const j=n==='D2';const d=30;const g=5;j?(a.x=(b.x1+b.x2)/2,a.y=(b.y1+b.y2)/2):(a.x+=a.vx,a.y+=a.vy,(a.x<b.x1+d+g||a.x>b.x2-d-g)&&(a.vx=-a.vx*t,a.x=Math.max(b.x1+d+g,Math.min(a.x,b.x2-d-g))),(a.y<b.y1+d+g||a.y>b.y2-d-g)&&(a.vy=-a.vy*t,a.y=Math.max(b.y1+d+g,Math.min(a.y,b.y2-d-g))),a.vx*=u,a.vy*=u);const p=Math.sqrt(a.vx*a.vx+a.vy*a.vy);const r=q(n);f&&clearTimeout(f);const s=Math.max(50,600-p*80);f=setTimeout(()=>{i=j?k%2+1:Math.floor(Math.random()*r)+1,m()},s),k++,m(),(k>=40||p<.5)&&(h&&clearInterval(h),f&&clearTimeout(f),j?(k%2===0&&k++,i=Math.random()<.5?1:2,Pip.audioStart(o.coinDrop)):i=Math.floor(Math.random()*r)+1,m(),l=!1)}function M(){h&&clearInterval(h),f&&clearTimeout(f),h=null,f=null}function p(){g.setColor(C),g.fillRect(0,0,w,x)}function D(a){g.setColor(n).drawRect(a.x1,a.y1,a.x2,a.y2)}function m(){g.setColor(C),g.fillRect(j.x,j.y,j.x+j.w,j.y+j.h);const f=60;const b=f/2;const h=e[c];let d=i.toString();const m=h==='D2';const o=k%2;if(g.setColor(n),m)l&&o===0?(g.fillRect(a.x-b,a.y-2,a.x+b,a.y+2),d=''):(g.drawCircle(a.x,a.y,b),d=i===1?'H':'T');else{const c=N(h);const d=[];for(let e=0;e<c;e++){const f=Math.PI/2+e*Math.PI*2/c;d.push([a.x+b*Math.cos(f),a.y+b*Math.sin(f)])}for(let a=0;a<c;a++){const b=d[a];const e=d[(a+1)%c];g.drawLine(b[0],b[1],e[0],e[1])}}if(d){g.setFont('6x8',3),g.setFontAlign(-1,-1,0);const b=g.stringWidth(d);const c=g.getFontHeight();g.drawString(d,a.x-b/2+2,a.y-c/2)}j={x:a.x-b-2,y:a.y-b-2,w:f+4,h:f+4}}function F(){const a=e[c];g.setColor(n).setFontMonofonto23().setFontAlign(1,-1,0).drawString(a,d.x2-5,d.y1+5)}function G(){g.setColor(n).setFontMonofonto23().setFontAlign(-1,-1,0).drawString(s,d.x1+5,d.y1+5);const a=g.stringWidth(s);g.setColor(K).setFontMonofonto16().setFontAlign(-1,-1,0).drawString('v'+H,d.x1+10+a,d.y1+5+8)}function N(a){switch(a){case'D2':return 0;case'D4':return 3;case'D6':return 4;case'D8':return 5;case'D10':return 6;case'D12':return 6;case'D20':return 6;default:return 6}}function q(a){return parseInt(a.substring(1))}function O(b){if(l)return;let a=Date.now();if(a-B<J)return;B=a,S()}function P(a){if(l)return;c+=a,c<0&&(c=e.length-1),c>=e.length&&(c=0),i=Math.floor(Math.random()*q(e[c]))+1,p(),F(),G(),D(b),m()}function Q(){M(),p(),R(),bC.clear(1).flip(),E.reboot()}function R(){Pip.removeAllListeners(y),Pip.removeAllListeners(z),Pip.removeAllListeners(A)}function S(){l=!0;const d=q(e[c]);i=Math.floor(Math.random()*d)+1,a.vx=(Math.random()*6-3)*v,a.vy=(Math.random()*6-3)*v,k=0,h&&clearInterval(h);const f=e[c]==='D2';let b=100;f?(b=150,Pip.audioStart(o.coinFlip)):Pip.audioStart(o.diceThrow),h=setInterval(L,b)}function T(){Pip.on(y,O),Pip.on(z,P),Pip.on(A,Q)}const r={};const s='Dice Roller';const H='1.1.0';const e=['D2','D4','D6','D8','D10','D12','D20'];const t=.95;const u=.98;const v=8;let c=e.indexOf('D20');let a={x:100,y:100,vx:2,vy:3};let i=1;let f=null;let h=null;let l=!1;let j={x:0,y:0,w:0,h:0};let k=0;const w=g.getWidth();const x=g.getHeight();const d={x1:60,x2:w-60,y1:10,y2:x-10};const I=35;const b={x1:d.x1,x2:d.x2,y1:d.y1+I,y2:d.y2};const y='knob1';const z='knob2';const A='torch';const J=100;let B=0;const C='#000000';const n='#00ff00';const K='#007f00';const o={coinDrop:'USER/coin-drop.wav',coinFlip:'USER/coin-flip.wav',diceThrow:'USER/dice-throw.wav'};return r.run=function(){bC.clear(),p(),T(),G(),F(),D(b),m()},r}DiceRoller().run()