{Pip.removeSubmenu&&Pip.removeSubmenu(),delete Pip.removeSubmenu,Pip.remove&&Pip.remove(),delete Pip.remove;let a=(typeof bC)[0]!='u'?bC:g,t=require('Storage'),M='flappy_hs',u=!0,y=t.readJSON(M,1)||0,e=!1,r=['RESUME','RESTART','QUIT (REBOOT)'],m=0,n=a.getWidth(),c=a.getHeight(),D=0,U='',b,d=[],s=0,h=!1,z=null,F=!1,A=null,v=!1,G=!1,H=!1,I=0,B=0,C=0,o=null,i=null,N=0,j=null,J=!0,p=!1,K=0,V=.4,W=-5,X=2.5,Y=40,w=15,Z=180,_='/USER/FLAPPYROACH/BeetleFlying.wav',$='/USER/FLAPPYROACH/HitGround.wav',a0='/USER/FLAPPYROACH/GameOver.wav',a1='/USER/FLAPPYROACH/SplatOnPipe.wav',O='/USER/FLAPPYROACH/StartGame.wav',k=null,l=null;function a5(){a.clear(),a.setFontAlign(-1,-1),a.setFont('6x8',2),f('FLAPPY-ROACH',Math.floor(c*.25)),a.setFont('6x8',1),f('Knob1 or Radio PLAY',Math.floor(c*.52)),f('to START',Math.floor(c*.6)),f('Torch: pause menu',Math.floor(c*.78)),q()}function L(){p=!1,u=!1,h=!1,e=!1,b.y=c/2,b.vy=0,d=[],Q(),x(O)}function a6(){if(F)return;F=!0;try{P(s)}catch(a){}try{T()}catch(a){}try{global.Pip&&Pip.removeAllListeners()}catch(a){}try{a.clear(),q()}catch(a){}setTimeout(()=>{E.reboot()},100)}function x(a){try{let b=!1;try{t&&(typeof t.read)[0]=='f'&&(b=t.read(a)!==undefined)}catch(a){}if(!b)return;try{Pip.audioStop()}catch(a){}try{Pip.audioStart(a)}catch(a){}}catch(a){}}function a7(){let a=getTime()*1e3;if(a-N<120)return;N=a,x(_)}function a8(c,d,f,g){let e=Math.max(2,f+Math.floor(g*6));a.fillRect(c-e,d-e,c+e,d+e);let b=e+2;a.fillRect(c-b,d-1,c-b+2,d+1),a.fillRect(c+b-2,d-1,c+b,d+1),a.fillRect(c-1,d-b,c+1,d-b+2),a.fillRect(c-1,d+b-2,c+1,d+b),a.fillRect(c-b,d-b,c-b+2,d-b+2),a.fillRect(c+b-2,d-b,c+b,d-b+2),a.fillRect(c-b,d+b-2,c-b+2,d+b),a.fillRect(c+b-2,d+b-2,c+b,d+b),j&&j.kind==='HIT'&&a.drawLine(c-e-2,d,c+e+2,d)}function a2(){if(getTime()<K)return;if(v){v=!1,aa();return}if(e&&!h){a9();return}if(u){L();return}if(h){R(),L();return}b.vy=W,B=6,C=-1,a7()}function P(a){a>y&&(y=a,t.writeJSON(M,y))}function a3(){e=!e,e&&(m=0,K=getTime()+.15,H=(typeof KNOB1_BTN)[0]!='u'?KNOB1_BTN.read():!1,G=(typeof BTN_PLAY)[0]!='u'?BTN_PLAY.read():!1)}function a9(){let b=r[m];if(b==='RESUME')e=!1;else if(b==='RESTART')e=!1,R(),L&&L();else if(b.indexOf('QUIT')===0){try{P(s)}catch(a){}try{a.clear(),q()}catch(a){}E.reboot()}}function aa(){if(p)return;p=!0,k&&(clearTimeout(k),k=null),l&&(clearTimeout(l),l=null),T();try{global.Pip&&Pip.removeAllListeners()}catch(a){}try{a.clear(),q()}catch(a){}k=setTimeout(()=>{k=null;try{a.clear(),q()}catch(a){}l=setTimeout(()=>{l=null;try{if((typeof submenuApps)[0]=='f')submenuApps();else if((typeof showMainMenu)[0]=='f')showMainMenu();else{a.clear(),a.setFont('6x8',2),a.setFontAlign(-1,-1);let b='Exited';let d=Math.max(0,n-a.stringWidth(b)>>1);a.drawString(b,d,Math.floor(c*.45)),q()}}catch(a){}},120)},40)}function q(){return a&&a.flip?a.flip():a&&a.flush?a.flush():a&&a.update?a.update():global.LCD&&LCD.flip?LCD.flip():void 0}function Q(){let a=Math.min(Y,c-30);let b=10;let e=c-a-b*2;let f=b+Math.random()*(e>0?e:1);d.push({x:n,gapY:f,scored:!1,gap:a})}function R(){n=a.getWidth(),c=a.getHeight(),e=!1,h=!1,v=!1,b={x:Math.floor(n*.25),y:c/2,vy:0,size:6},d=[],s=0,u=!0}function ab(){if(p)return;if(d||(d=[]),(typeof BTN_PLAY)[0]!='u'){let a=BTN_PLAY.read();a&&!G&&a2(),G=a}if((typeof KNOB1_BTN)[0]!='u'){let a=KNOB1_BTN.read();a&&!H&&a2(),H=a}if(v)return;if(u)return;if(h||e)return;B>0&&B--;let a=0;b&&isFinite(b.vy)&&(a=b.vy<0?-1:1),C+=(a-C)*.15,b.vy+=V,b.y+=b.vy,isFinite(b.y)||(b.y=c/2,b.vy=0),(b.y<0||b.y+b.size>c)&&a4('FELL');for(let c=0;c<d.length;c++){let a=d[c];a.x-=X,b.x+b.size>a.x&&b.x<a.x+w&&(b.y<a.gapY||b.y+b.size>a.gapY+a.gap)&&a4('HIT'),!a.scored&&a.x+w<b.x&&(a.scored=!0,s++)}let f=d[d.length-1];f?f.x<=n-Z&&Q():Q(),d.length&&d[0].x<-w&&d.shift()}function f(b,e){if(p)return;a.setFontAlign(-1,-1);let c=a.stringWidth(b);let d=Math.max(0,Math.floor((n-c)/2));a.drawString(b,d,e)}function S(){if(p)return;if(u){a5();return}if(v)return;d||(d=[]),a.clear();for(let b=0;b<d.length;b++){let e=d[b];a.fillRect(e.x,0,e.x+w,e.gapY),a.fillRect(e.x,e.gapY+e.gap,e.x+w,c)}if(ac(b.x,b.y,b.size,I,B,C),a.setFont('6x8',2),a.setFontAlign(-1,-1),a.drawString(' Score: '+s,2,2),h){if(!J&&j){let a=Math.min(1,(getTime()-j.t0)/.75);a8(j.x,j.y,3,a),q();return}a.clear(),a.setFont('6x8',3),f('GAME OVER',Math.floor(c*.14)),a.setFont('6x8',2),f('Score: '+D,Math.floor(c*.3)),f('Highest Score: '+y,Math.floor(c*.4)),f('Knob1/Radio: Play Again',Math.floor(c*.64)),f('Power: Exit to MAIN',Math.floor(c*.74))}else e&&ae();q()}function ac(d,e,m,n,j,k){let b=Math.max(1,Math.floor(m/3));let h=Math.round(-k*2);let i=Math.round(k*2);a.fillRect(d+1*b+h,e+1*b,d+5*b+i,e+4*b),a.fillRect(d+2*b+h,e+0*b,d+4*b+h,e+1*b),a.fillRect(d+1*b+i,e+4*b,d+5*b+i,e+5*b);let l=I>>3&1;let f=d+2*b+h;let g=d+4*b+h;let c=e+0*b;if(a.fillRect(f,c,f,c),a.fillRect(g,c,g,c),l&&(a.fillRect(f-1,c,f-1,c),a.fillRect(f+1,c,f+1,c),a.fillRect(f,c-1,f,c-1),a.fillRect(f,c+1,f,c+1),a.fillRect(g-1,c,g-1,c),a.fillRect(g+1,c,g+1,c),a.fillRect(g,c-1,g,c-1),a.fillRect(g,c+1,g,c+1)),j>0){let c=j&1?3:2;a.drawLine(d+1*b+h,e+2*b,d-c*b,e+1*b),a.drawLine(d+1*b+h,e+3*b,d-c*b,e+4*b),a.drawLine(d+5*b+i,e+2*b,d+(6+c)*b,e+1*b),a.drawLine(d+5*b+i,e+3*b,d+(6+c)*b,e+4*b)}a.fillRect(d+0*b+h,e+2*b,d+0*b+h,e+2*b),a.fillRect(d+6*b+i,e+2*b,d+6*b+i,e+2*b)}function ad(){Pip.removeAllListeners(),Pip.on('torch',()=>{!h&&(typeof a3)[0]=='f'&&a3()}),Pip.on('knob1',a=>{if(e&&!h){a>0?m=(m+1)%r.length:a<0&&(m=(m+r.length-1)%r.length);return}})}function ae(){a.clear(),a.setFontAlign(-1,-1),a.drawRect(10,20,n-10,c-20),a.setFont('6x8',3),f('PAUSED',28),a.setFont('6x8',2);for(let a=0;a<r.length;a++){let b=56+a*16;let c=(a===m?'> ':'  ')+r[a];f(c,b)}a.setFont('6x8',1.5),f('Torch: Pause/Resume',c-40),f('Knob1 Press: Select',c-30)}function T(){z&&(clearInterval(z),z=null),A&&(clearWatch(A),A=null),k&&(clearTimeout(k),k=null),l&&(clearTimeout(l),l=null),o&&(clearTimeout(o),o=null),i&&(clearTimeout(i),i=null),global.Pip&&Pip.removeAllListeners()}function a4(a){h=!0,e=!1,K=getTime()+.75,D=s,P(D),U=a||'',J=!1,j={kind:a,x:Math.round(b.x+b.size/2),y:a==='FELL'?Math.min(c-6,Math.round(b.y+b.size/2)):Math.round(b.y+b.size/2),t0:getTime()},a==='HIT'&&x(a1),a==='FELL'&&x($),o&&(clearTimeout(o),o=null),i&&(clearTimeout(i),i=null),o=setTimeout(()=>x(a0),500),i=setTimeout(()=>{J=!0,j=null,i=null},750)}function af(){p=!1,T(),R(),S(),x(O),ad(),F=!1,A=setWatch(()=>a6(),BTN_POWER,{debounce:50,edge:'rising',repeat:!0}),S(),z=setInterval(()=>{ab(),S(),I++},50)}af()}