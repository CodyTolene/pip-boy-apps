{Pip.removeSubmenu&&Pip.removeSubmenu(),delete Pip.removeSubmenu,Pip.remove&&Pip.remove(),delete Pip.remove;let a=(typeof bC)[0]!='u'?bC:g,G=require('Storage'),H='flappy_hs',o=!0,s=G.readJSON(H,1)||0,e=!1,m=['RESUME','RESTART','QUIT (REBOOT)'],k=0,n=a.getWidth(),c=a.getHeight(),x=0,b,d=[],p=0,h=!1,t=null,u=null,y=!1,z=!1,A=0,v=0,w=0,l=null,i=null,I=0,j=null,B=!0,C=0,N=.4,O=-5,P=2.5,Q=40,q=15,R=180,S='/USER/FLAPPYROACH/BeetleFlying.wav',T='/USER/FLAPPYROACH/HitGround.wav',U='/USER/FLAPPYROACH/GameOver.wav',V='/USER/FLAPPYROACH/SplatOnPipe.wav',J='/USER/FLAPPYROACH/StartGame.wav';function _(){a.clear(),a.setFontAlign(-1,-1),a.setFont('6x8',2),f('FLAPPY-ROACH',Math.floor(c*.25)),a.setFont('6x8',1),f('Knob1 or Radio PLAY',Math.floor(c*.52)),f('to START',Math.floor(c*.6)),f('Torch: pause menu',Math.floor(c*.78)),F()}function D(){o=!1,h=!1,e=!1,b.y=c/2,b.vy=0,d=[],K(),r(J)}function r(a){try{Pip.audioStop(),Pip.audioStart(a)}catch(a){}}function $(){let a=getTime()*1e3;if(a-I<120)return;I=a,r(S)}function a0(c,d,f,g){let e=Math.max(2,f+Math.floor(g*6));a.fillRect(c-e,d-e,c+e,d+e);let b=e+2;a.fillRect(c-b,d-1,c-b+2,d+1),a.fillRect(c+b-2,d-1,c+b,d+1),a.fillRect(c-1,d-b,c+1,d-b+2),a.fillRect(c-1,d+b-2,c+1,d+b),a.fillRect(c-b,d-b,c-b+2,d-b+2),a.fillRect(c+b-2,d-b,c+b,d-b+2),a.fillRect(c-b,d+b-2,c-b+2,d+b),a.fillRect(c+b-2,d+b-2,c+b,d+b),j&&j.kind==='HIT'&&a.drawLine(c-e-2,d,c+e+2,d)}function W(){if(getTime()<C)return;if(e&&!h){a1();return}if(o){D();return}if(h){L(),D();return}b.vy=O,v=6,w=-1,$()}function X(a){a>s&&(s=a,G.writeJSON(H,s))}function Y(){e=!e,e&&(k=0,C=getTime()+.15,z=(typeof KNOB1_BTN)[0]!='u'?KNOB1_BTN.read():!1,y=(typeof BTN_PLAY)[0]!='u'?BTN_PLAY.read():!1)}function a1(){let b=m[k];if(b==='RESUME')e=!1;else if(b==='RESTART')e=!1,L(),D&&D();else if(b.indexOf('QUIT')===0){try{X(p)}catch(a){}try{a.clear(),F()}catch(a){}E.reboot()}}function F(){return a&&a.flip?a.flip():a&&a.flush?a.flush():a&&a.update?a.update():global.LCD&&LCD.flip?LCD.flip():void 0}function K(){let a=Math.min(Q,c-30);let b=10;let e=c-a-b*2;let f=b+Math.random()*(e>0?e:1);d.push({x:n,gapY:f,scored:!1,gap:a})}function L(){n=a.getWidth(),c=a.getHeight(),e=!1,h=!1,b={x:Math.floor(n*.25),y:c/2,vy:0,size:6},d=[],p=0,o=!0}function a2(){if(d||(d=[]),(typeof BTN_PLAY)[0]!='u'){let a=BTN_PLAY.read();a&&!y&&W(),y=a}if((typeof KNOB1_BTN)[0]!='u'){let a=KNOB1_BTN.read();a&&!z&&W(),z=a}if(o)return;if(h||e)return;v>0&&v--;let a=0;b&&isFinite(b.vy)&&(a=b.vy<0?-1:1),w+=(a-w)*.15,b.vy+=N,b.y+=b.vy,isFinite(b.y)||(b.y=c/2,b.vy=0),(b.y<0||b.y+b.size>c)&&Z('FELL');for(let c=0;c<d.length;c++){let a=d[c];a.x-=P,b.x+b.size>a.x&&b.x<a.x+q&&(b.y<a.gapY||b.y+b.size>a.gapY+a.gap)&&Z('HIT'),!a.scored&&a.x+q<b.x&&(a.scored=!0,p++)}let f=d[d.length-1];f?f.x<=n-R&&K():K(),d.length&&d[0].x<-q&&d.shift()}function f(b,e){a.setFontAlign(-1,-1);let c=a.stringWidth(b);let d=Math.max(0,Math.floor((n-c)/2));a.drawString(b,d,e)}function M(){if(o){_();return}d||(d=[]),a.clear();for(let b=0;b<d.length;b++){let e=d[b];a.fillRect(e.x,0,e.x+q,e.gapY),a.fillRect(e.x,e.gapY+e.gap,e.x+q,c)}if(a3(b.x,b.y,b.size,A,v,w),a.setFont('6x8',2),a.setFontAlign(-1,-1),a.drawString(' Score: '+p,2,2),h){if(!B&&j){let a=Math.min(1,(getTime()-j.t0)/.75);a0(j.x,j.y,3,a),F();return}a.clear(),a.setFont('6x8',3),f('GAME OVER',Math.floor(c*.14)),a.setFont('6x8',2),f('Score: '+x,Math.floor(c*.3)),f('Highest Score: '+s,Math.floor(c*.4)),f('Knob1/Radio: Play Again',Math.floor(c*.64)),f('Power: Exit to MAIN',Math.floor(c*.74))}else e&&a5();F()}function a3(d,e,m,n,j,k){let b=Math.max(1,Math.floor(m/3));let h=Math.round(-k*2);let i=Math.round(k*2);a.fillRect(d+1*b+h,e+1*b,d+5*b+i,e+4*b),a.fillRect(d+2*b+h,e+0*b,d+4*b+h,e+1*b),a.fillRect(d+1*b+i,e+4*b,d+5*b+i,e+5*b);let l=A>>3&1;let f=d+2*b+h;let g=d+4*b+h;let c=e+0*b;if(a.fillRect(f,c,f,c),a.fillRect(g,c,g,c),l&&(a.fillRect(f-1,c,f-1,c),a.fillRect(f+1,c,f+1,c),a.fillRect(f,c-1,f,c-1),a.fillRect(f,c+1,f,c+1),a.fillRect(g-1,c,g-1,c),a.fillRect(g+1,c,g+1,c),a.fillRect(g,c-1,g,c-1),a.fillRect(g,c+1,g,c+1)),j>0){let c=j&1?3:2;a.drawLine(d+1*b+h,e+2*b,d-c*b,e+1*b),a.drawLine(d+1*b+h,e+3*b,d-c*b,e+4*b),a.drawLine(d+5*b+i,e+2*b,d+(6+c)*b,e+1*b),a.drawLine(d+5*b+i,e+3*b,d+(6+c)*b,e+4*b)}a.fillRect(d+0*b+h,e+2*b,d+0*b+h,e+2*b),a.fillRect(d+6*b+i,e+2*b,d+6*b+i,e+2*b)}function a4(){Pip.removeAllListeners(),Pip.on('torch',()=>{!h&&(typeof Y)[0]=='f'&&Y()}),Pip.on('knob1',a=>{if(e&&!h){a>0?k=(k+1)%m.length:a<0&&(k=(k+m.length-1)%m.length);return}})}function a5(){a.clear(),a.setFontAlign(-1,-1),a.drawRect(10,20,n-10,c-20),a.setFont('6x8',3),f('PAUSED',28),a.setFont('6x8',2);for(let a=0;a<m.length;a++){let b=56+a*16;let c=(a===k?'> ':'  ')+m[a];f(c,b)}a.setFont('6x8',1.5),f('Torch: Pause/Resume',c-40),f('Knob1 Press: Select',c-30)}function a6(){t&&(clearInterval(t),t=null),u&&(clearWatch(u),u=null),l&&(clearTimeout(l),l=null),i&&(clearTimeout(i),i=null),global.Pip&&Pip.removeAllListeners()}function Z(a){h=!0,e=!1,C=getTime()+.75,x=p,X(x),B=!1,j={kind:a,x:Math.round(b.x+b.size/2),y:a==='FELL'?Math.min(c-6,Math.round(b.y+b.size/2)):Math.round(b.y+b.size/2),t0:getTime()},a==='HIT'&&r(V),a==='FELL'&&r(T),l&&(clearTimeout(l),l=null),i&&(clearTimeout(i),i=null),l=setTimeout(()=>r(U),500),i=setTimeout(()=>{B=!0,j=null,i=null},750)}function a7(){a6(),L(),M(),r(J),a4(),u=setWatch(()=>{E.reboot()},BTN_POWER,{debounce:50,edge:'rising',repeat:!0}),M(),t=setInterval(()=>{a2(),M(),A++},50)}a7()}