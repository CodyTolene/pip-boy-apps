{Pip.removeSubmenu&&Pip.removeSubmenu(),delete Pip.removeSubmenu,Pip.remove&&Pip.remove(),delete Pip.remove;let a=(typeof bC)[0]!='u'?bC:g,J=require('Storage'),K='flappy_hs',q=!0,u=J.readJSON(K,1)||0,e=!1,p=['RESUME GAME','RESTART GAME','QUIT (REBOOT)'],n=0,h=a.getWidth(),c=a.getHeight(),z=0,b,d=[],r=0,j=!1,v=null,w=null,A=!1,B=!1,C=0,x=0,y=0,o=null,k=null,L=0,l=null,D=!0,F=0,Q=.4,R=-5,S=2.5,T=40,s=15,U=180,V='/USER/FLAPPYROACH/BeetleFlying.wav',W='/USER/FLAPPYROACH/HitGround.wav',X='/USER/FLAPPYROACH/GameOver.wav',Y='/USER/FLAPPYROACH/SplatOnPipe.wav',M='/USER/FLAPPYROACH/StartGame.wav',Z=8,_=10,a2=0,i=Z,m=c-_;function a3(){a.clear(),a.setFontAlign(-1,-1),a.setFont('6x8',2),f('FLAPPY ROACH',Math.floor(c*.25)),a.setFont('6x8',1),f('Knob1 or Radio PLAY',Math.floor(c*.52)),f('to START',Math.floor(c*.6)),f('Torch: pause menu',Math.floor(c*.78)),H()}function G(){q=!1,j=!1,e=!1,b.y=c/2,b.vy=0,d=[],N(),t(M)}function t(a){try{Pip.audioStop(),Pip.audioStart(a)}catch(a){}}function a4(){let a=getTime()*1e3;if(a-L<120)return;L=a,t(V)}function a5(c,d,f,g){let e=Math.max(2,f+Math.floor(g*6));a.fillRect(c-e,d-e,c+e,d+e);let b=e+2;a.fillRect(c-b,d-1,c-b+2,d+1),a.fillRect(c+b-2,d-1,c+b,d+1),a.fillRect(c-1,d-b,c+1,d-b+2),a.fillRect(c-1,d+b-2,c+1,d+b),a.fillRect(c-b,d-b,c-b+2,d-b+2),a.fillRect(c+b-2,d-b,c+b,d-b+2),a.fillRect(c-b,d+b-2,c-b+2,d+b),a.fillRect(c+b-2,d+b-2,c+b,d+b),l&&l.kind==='HIT'&&a.drawLine(c-e-2,d,c+e+2,d)}function $(){if(getTime()<F)return;if(e&&!j){a6();return}if(q){G();return}if(j){O(),G();return}b.vy=R,x=6,y=-1,a4()}function a0(a){a>u&&(u=a,J.writeJSON(K,u))}function a1(){e=!e,e&&(n=0,F=getTime()+.15,B=(typeof KNOB1_BTN)[0]!='u'?KNOB1_BTN.read():!1,A=(typeof BTN_PLAY)[0]!='u'?BTN_PLAY.read():!1)}function a6(){let b=p[n];if(b==='RESUME GAME')e=!1;else if(b==='RESTART GAME')e=!1,O(),G&&G();else if(b.indexOf('QUIT')===0){try{a0(r)}catch(a){}try{a.clear(),H()}catch(a){}E.reboot()}}function H(){return a&&a.flip?a.flip():a&&a.flush?a.flush():a&&a.update?a.update():global.LCD&&LCD.flip?LCD.flip():void 0}function N(){const b=i;const g=m;const c=g-b;let a=Math.min(T,c-20);a<10&&(a=10);let e=10;let f=c-a-e*2;let j=b+e+Math.random()*(f>0?f:1);d.push({x:h,gapY:j,scored:!1,gap:a})}function O(){h=a.getWidth(),c=a.getHeight(),e=!1,j=!1,b={x:Math.floor(h*.25),y:c/2,vy:0,size:6},d=[],r=0,q=!0}function a7(){a.setColor(0,0,0),a.fillRect(0,0,h-1,i-1),a.fillRect(0,m,h-1,c-1),a.setColor(1,1,1),a.drawLine(0,i-1,h-1,i-1),a.drawLine(0,m,h-1,m)}function a8(){if(d||(d=[]),(typeof BTN_PLAY)[0]!='u'){let a=BTN_PLAY.read();a&&!A&&$(),A=a}if((typeof KNOB1_BTN)[0]!='u'){let a=KNOB1_BTN.read();a&&!B&&$(),B=a}if(q)return;if(j||e)return;x>0&&x--;let a=0;b&&isFinite(b.vy)&&(a=b.vy<0?-1:1),y+=(a-y)*.15,b.vy+=Q,b.y+=b.vy,isFinite(b.y)||(b.y=c/2,b.vy=0),(b.y<0||b.y+b.size>c)&&I('FELL'),b.y<=i?(b.y=i,I('HIT')):b.y+b.size>=m&&(b.y=m-b.size,I('HIT'));for(let c=0;c<d.length;c++){let a=d[c];if(a.x-=S,b.x+b.size>a.x&&b.x<a.x+s){let c=Math.max(a.gapY,i);let d=Math.min(a.gapY+a.gap,m);(b.y<c||b.y+b.size>d)&&I('HIT')}!a.scored&&a.x+s<b.x&&(a.scored=!0,r++)}let f=d[d.length-1];f?f.x<=h-U&&N():N(),d.length&&d[0].x<-s&&d.shift()}function f(b,e){a.setFontAlign(-1,-1);let c=a.stringWidth(b);let d=Math.max(0,Math.floor((h-c)/2));a.drawString(b,d,e)}function P(){if(q){a3();return}d||(d=[]),a.clear(),a7();for(let b=0;b<d.length;b++){let c=d[b];let e=Math.max(c.gapY,i);a.fillRect(c.x,i,c.x+s,e),a.fillRect(c.x,e+c.gap,c.x+s,m)}if(a9(b.x,b.y,b.size,C,x,y),a.setFont('6x8',2),a.setFontAlign(-1,-1),a.drawString('Score: '+r,2,i+2),j){if(!D&&l){let a=Math.min(1,(getTime()-l.t0)/.75);a5(l.x,l.y,3,a),H();return}a.clear(),a.setFont('6x8',3),f('GAME OVER',Math.floor(c*.14)),a.setFont('6x8',2),f('Score: '+z,Math.floor(c*.3)),f('Highest Score: '+u,Math.floor(c*.4)),f('Knob1/Radio: Play Again',Math.floor(c*.64)),f('Power: Exit to MAIN',Math.floor(c*.74))}else e&&ab();H()}function a9(d,e,m,n,j,k){let b=Math.max(1,Math.floor(m/3));let h=Math.round(-k*2);let i=Math.round(k*2);a.fillRect(d+1*b+h,e+1*b,d+5*b+i,e+4*b),a.fillRect(d+2*b+h,e+0*b,d+4*b+h,e+1*b),a.fillRect(d+1*b+i,e+4*b,d+5*b+i,e+5*b);let l=C>>3&1;let f=d+2*b+h;let g=d+4*b+h;let c=e+0*b;if(a.fillRect(f,c,f,c),a.fillRect(g,c,g,c),l&&(a.fillRect(f-1,c,f-1,c),a.fillRect(f+1,c,f+1,c),a.fillRect(f,c-1,f,c-1),a.fillRect(f,c+1,f,c+1),a.fillRect(g-1,c,g-1,c),a.fillRect(g+1,c,g+1,c),a.fillRect(g,c-1,g,c-1),a.fillRect(g,c+1,g,c+1)),j>0){let c=j&1?3:2;a.drawLine(d+1*b+h,e+2*b,d-c*b,e+1*b),a.drawLine(d+1*b+h,e+3*b,d-c*b,e+4*b),a.drawLine(d+5*b+i,e+2*b,d+(6+c)*b,e+1*b),a.drawLine(d+5*b+i,e+3*b,d+(6+c)*b,e+4*b)}a.fillRect(d+0*b+h,e+2*b,d+0*b+h,e+2*b),a.fillRect(d+6*b+i,e+2*b,d+6*b+i,e+2*b)}function aa(){Pip.removeAllListeners(),Pip.on('torch',()=>{!j&&(typeof a1)[0]=='f'&&a1()}),Pip.on('knob1',a=>{if(e&&!j){a<0?n=(n+1)%p.length:a>0&&(n=(n+p.length-1)%p.length);return}})}function ab(){a.clear(),a.setFontAlign(-1,-1),a.drawRect(10,20,h-10,c-20),a.setFont('6x8',3),f('PAUSED',28),a.setFont('6x8',2);for(let a=0;a<p.length;a++){let b=56+a*16;let c=(a===n?'> ':'  ')+p[a];f(c,b)}a.setFont('6x8',1.5),f('Top Torch Press: Resume',c-40),f('Left Knob Press: Select',c-30)}function ac(){v&&(clearInterval(v),v=null),w&&(clearWatch(w),w=null),o&&(clearTimeout(o),o=null),k&&(clearTimeout(k),k=null),global.Pip&&Pip.removeAllListeners()}function I(a){j=!0,e=!1,F=getTime()+.75,z=r,a0(z),D=!1,l={kind:a,x:Math.round(b.x+b.size/2),y:a==='FELL'?Math.min(c-6,Math.round(b.y+b.size/2)):Math.round(b.y+b.size/2),t0:getTime()},a==='HIT'&&t(Y),a==='FELL'&&t(W),o&&(clearTimeout(o),o=null),k&&(clearTimeout(k),k=null),o=setTimeout(()=>t(X),500),k=setTimeout(()=>{D=!0,l=null,k=null},750)}function ad(){ac(),O(),P(),t(M),aa(),w=setWatch(()=>{E.reboot()},BTN_POWER,{debounce:50,edge:'rising',repeat:!0}),P(),v=setInterval(()=>{a8(),P(),C++},50)}ad()}