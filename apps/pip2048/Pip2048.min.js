function initGame(){board=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],addRandomTile(),addRandomTile(),g.clear(),drawBoard()}function addRandomTile(){var a=[];for(var b=0;b<4;b++)for(var c=0;c<4;c++)board[b][c]===0&&a.push({x:c,y:b});if(a.length===0)return;var d=a[Math.floor(Math.random()*a.length)];board[d.y][d.x]=Math.random()<.9?2:4}function drawBoard(){for(var b=0;b<4;b++)for(var c=0;c<4;c++){var a=board[b][c],i=tileColors[a]||'#888',d=c*tileSize+offsetX+tilePadding,e=b*tileSize+offsetY+tilePadding;if(g.setColor(i),g.fillRect(d,e,d+tileSize-tilePadding*2,e+tileSize-tilePadding*2),a!==0){g.setColor(0,0,0);var f=a>=1024?26:a>=128?30:36;g.setFontVector(f);var h=a.toString(),j=h.length*f*.5;g.drawString(h,d+tileSize/2-tilePadding/2,e+tileSize/2-tilePadding/2)}}isGameOver()&&(g.setColor('#CCC'),g.fillRect(screenWidth/2-100,screenHeight/2-20,screenWidth/2+100,screenHeight/2+20),g.setColor(255,0,0),g.setFontVector(28),g.drawString('GAME OVER',screenWidth/2,screenHeight/2))}function moveLeft(e){var d=!1;for(var c=0;c<4;c++){var a=board[c].filter(a=>a);for(var b=0;b<a.length-1;b++)a[b]===a[b+1]&&(a[b]*=2,a[b+1]=0,d=!0);a=a.filter(a=>a);while(a.length<4)a.push(0);board[c].join()!==a.join()&&(d=!0),board[c]=a}return d&&e&&(addRandomTile(),drawBoard()),d}function moveRight(){reverseBoardRows();var a=moveLeft();reverseBoardRows(),a&&(addRandomTile(),drawBoard())}function moveUp(){transposeBoard();var a=moveLeft();transposeBoard(),a&&(addRandomTile(),drawBoard())}function moveDown(){transposeBoard(),reverseBoardRows();var a=moveLeft();reverseBoardRows(),transposeBoard(),a&&(addRandomTile(),drawBoard())}function transposeBoard(){var c=[];for(var a=0;a<4;a++){c[a]=[];for(var b=0;b<4;b++)c[a][b]=board[b][a]}board=c}function reverseBoardRows(){for(var a=0;a<4;a++)board[a].reverse()}function isGameOver(){for(var a=0;a<4;a++)for(var b=0;b<4;b++){if(board[a][b]===0)return!1;if(b<3&&board[a][b]===board[a][b+1])return!1;if(a<3&&board[a][b]===board[a+1][b])return!1}return!0}var board=[],screenWidth=400,screenHeight=320,tileSize=75,tilePadding=5,offsetX=Math.floor((screenWidth-tileSize*4)/2),offsetY=Math.floor((screenHeight-tileSize*4)/2),tileColors={0:'#888',2:'#EEE',4:'#EDD',8:'#F48',16:'#F96',32:'#F75',64:'#F53',128:'#ED7',256:'#EC6',512:'#EB5',1024:'#EA4',2048:'#E93',4096:'#332',8192:'#221'};Pip.removeAllListeners('knob1'),Pip.on('knob1',function(a){Pip.knob1Click(a),a<0?moveDown():a>0?moveUp():initGame()}),Pip.removeAllListeners('knob2'),Pip.on('knob2',function(a){Pip.knob2Click(a),a<0?moveLeft(1):a>0&&moveRight()}),Pip.removeAllListeners('torch'),Pip.on('torch',function(){console.log('Game stopping'),g.clear(),E.reboot()}),initGame()